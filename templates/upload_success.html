<!-- 
============================================================================
ШАБЛОН СТРАНИЦЫ УСПЕШНОЙ ЗАГРУЗКИ - РЕЗУЛЬТАТЫ ОПЕРАЦИИ
============================================================================

Этот шаблон отображает результаты успешной загрузки изображения,
предоставляя пользователю всю необходимую информацию о загруженном файле
и возможности для дальнейших действий.

Основные функции:
- Подтверждение успешной загрузки с визуальной обратной связью
- Отображение превью загруженного изображения
- Предоставление метаданных файла (имя, размер)
- Кнопки для просмотра, скачивания и копирования ссылки
- Навигационные элементы для продолжения работы
- JavaScript функциональность копирования ссылок

Технические особенности:
- Наследует базовый шаблон для консистентности
- Использует Bootstrap Card для структурированного отображения
- Jinja2 переменные для динамического контента
- Clipboard API для копирования ссылок
- Адаптивная верстка для всех устройств

Пользовательский опыт:
- Четкое подтверждение успешной операции
- Немедленный доступ к результату загрузки
- Множественные варианты действий с файлом
- Интуитивная навигация к следующим шагам
- Визуальная обратная связь при копировании

Интеграция с системой:
- Получает данные от Flask route после загрузки
- Использует URL генерацию Flask для ссылок
- Интегрируется с системой управления файлами
- Поддерживает сессии пользователей

Безопасность:
- Отображает только авторизованному пользователю
- Безопасное формирование URL для файлов
- Проверка прав доступа к изображениям
- Экранирование пользовательского контента

============================================================================
-->

<!-- Наследуем базовый шаблон с общей структурой -->
{% extends 'base.html' %}

<!-- Устанавливаем заголовок страницы результатов -->
{% block title %}Результаты загрузки - Фото Хостинг{% endblock %}

<!-- Основной контент страницы результатов загрузки -->
{% block content %}
<!-- ========================================================================
     ОСНОВНОЙ КОНТЕЙНЕР СТРАНИЦЫ РЕЗУЛЬТАТОВ
     ======================================================================== -->
<div class="container mt-4">
    <!-- Заголовок страницы результатов -->
    <h2 class="mb-4">Результаты загрузки файлов</h2>
    
    <!-- ====================================================================
         FLASH-СООБЩЕНИЯ ДЛЯ СТРАНИЦЫ РЕЗУЛЬТАТОВ ЗАГРУЗКИ
         ==================================================================== -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else ('warning' if category == 'warning' else ('info' if category == 'info' else 'success')) }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <!-- ====================================================================
         УВЕДОМЛЕНИЕ ОБ УСПЕШНОЙ ЗАГРУЗКЕ
         Визуальное подтверждение успешной операции
         ==================================================================== -->
    <div class="alert alert-success" role="alert">
        <h5 class="alert-heading">✅ Успешно загружено: 1 файл</h5>
    </div>
    
    <!-- ====================================================================
         КАРТОЧКА ЗАГРУЖЕННОГО ИЗОБРАЖЕНИЯ
         Отображение результата загрузки с превью и метаданными
         ==================================================================== -->
    <div class="row">
        <!-- Адаптивная колонка для карточки изображения -->
        <div class="col-md-6 col-lg-4 mb-4">
            <div class="card">
                <!-- ========================================================
                     ЗАГОЛОВОК КАРТОЧКИ
                     Отображение оригинального имени файла
                     ======================================================== -->
                <div class="card-header bg-success text-white">
                    <!-- Оригинальное имя файла от пользователя -->
                    <h6 class="mb-0">{{ original_name }}</h6>
                </div>
                
                <!-- ========================================================
                     ТЕЛО КАРТОЧКИ: ПРЕВЬЮ И МЕТАДАННЫЕ
                     ======================================================== -->
                <div class="card-body text-center">
                    <!-- Превью загруженного изображения -->
                    <img src="{{ image_url }}" 
                         alt="{{ filename }}" 
                         class="img-fluid mb-3" 
                         style="max-height: 200px;">
                    
                    <!-- Метаданные файла -->
                    <!-- Новое имя файла в системе (UUID-based) -->
                    <p><strong>Новое имя:</strong> {{ filename }}</p>
                    <!-- Размер файла в килобайтах -->
                    <p><strong>Размер:</strong> {{ "%.2f"|format(file_size / 1024) }} KB</p>
                    
                    <!-- ================================================
                         ПАНЕЛЬ ДЕЙСТВИЙ С ИЗОБРАЖЕНИЕМ
                         Кнопки для различных операций с файлом
                         ================================================ -->
                    <div class="btn-group-vertical d-grid gap-2">
                        <!-- Кнопка просмотра в полном размере -->
                        <a href="{{ view_url }}" 
                           class="btn btn-sm btn-primary" 
                           target="_blank">Просмотр</a>
                        
                        <!-- Кнопка скачивания с оригинальным именем -->
                        <a href="{{ download_url }}" 
                           class="btn btn-sm btn-success" 
                           download="{{ original_name }}">Скачать</a>
                        
                        <!-- Кнопка копирования прямой ссылки -->
                        <button class="btn btn-sm btn-outline-primary copy-btn" 
                                data-url="{{ image_url }}">Копировать ссылку</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ====================================================================
         НАВИГАЦИОННЫЕ КНОПКИ
         Варианты дальнейших действий пользователя
         ==================================================================== -->
    <div class="mt-4">
        <!-- Кнопка для загрузки дополнительных файлов -->
        <a href="{{ url_for('upload_file') }}" class="btn btn-primary">
            Загрузить еще файлы
        </a>
        
        <!-- Кнопка перехода к списку всех изображений -->
        <a href="{{ url_for('images_list') }}" class="btn btn-secondary">
            Мои изображения
        </a>
        
        <!-- Кнопка возврата на главную страницу -->
        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
            На главную
        </a>
    </div>
</div>

<!-- ========================================================================
     JAVASCRIPT ДЛЯ КОПИРОВАНИЯ ССЫЛОК
     Функциональность копирования URL изображения в буфер обмена
     ======================================================================== -->
<script>
/**
 * Инициализация функциональности копирования ссылок на изображения
 * 
 * Обеспечивает возможность копирования прямых ссылок на загруженные
 * изображения в буфер обмена с визуальной обратной связью.
 * 
 * Особенности:
 * - Использует современный Clipboard API
 * - Предоставляет визуальную обратную связь
 * - Обрабатывает ошибки копирования
 * - Автоматически восстанавливает исходное состояние кнопки
 */
document.addEventListener('DOMContentLoaded', function() {
    // Находим все кнопки копирования на странице
    const copyButtons = document.querySelectorAll('.copy-btn');
    
    // Добавляем обработчик для каждой кнопки копирования
    copyButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Получаем URL изображения из data-атрибута
            const url = this.getAttribute('data-url');
            
            // ========================================================
            // КОПИРОВАНИЕ В БУФЕР ОБМЕНА С ОБРАТНОЙ СВЯЗЬЮ
            // ========================================================
            navigator.clipboard.writeText(url).then(function() {
                // Показываем временное уведомление о копировании
                showTemporaryAlert('Ссылка скопирована в буфер обмена', 'info', 3000);
                
                // Сохраняем оригинальный текст кнопки
                const originalText = button.textContent;
                
                // Временно изменяем внешний вид кнопки для обратной связи
                button.textContent = 'Скопировано!';
                button.classList.remove('btn-outline-primary');
                button.classList.add('btn-success');
                
                // Восстанавливаем исходное состояние через 2 секунды
                setTimeout(function() {
                    button.textContent = originalText;
                    button.classList.remove('btn-success');
                    button.classList.add('btn-outline-primary');
                }, 2000);
                
            }).catch(function(err) {
                // ========================================================
                // ОБРАБОТКА ОШИБОК КОПИРОВАНИЯ
                // ========================================================
                
                // Логируем ошибку для отладки
                console.error('Ошибка копирования: ', err);
                
                // Показываем пользователю сообщение об ошибке
                alert('Не удалось скопировать ссылку');
                
                // Возможные причины ошибок:
                // - Браузер не поддерживает Clipboard API
                // - Страница загружена не по HTTPS
                // - Пользователь не дал разрешение на доступ к буферу обмена
            });
        });
    });
});
</script>
{% endblock %}