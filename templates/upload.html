<!-- ======================================================================== -->
<!-- –°–¢–†–ê–ù–ò–¶–ê –ó–ê–ì–†–£–ó–ö–ò –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô -->
<!-- ======================================================================== -->
<!-- 
     –≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
     - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
     - –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –∏ –æ–±—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
     - –í–∞–ª–∏–¥–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –∏ —Ç–∏–ø–∞ —Ñ–∞–π–ª–æ–≤
     - –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
     - AJAX –∑–∞–≥—Ä—É–∑–∫–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
-->

{% extends "base.html" %}

{% block title %}–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è - –§–æ—Ç–æ –•–æ—Å—Ç–∏–Ω–≥{% endblock %}

{% block content %}

<!-- ======================================================================== -->
<!-- FLASH-–°–û–û–ë–©–ï–ù–ò–Ø –î–õ–Ø –°–¢–†–ê–ù–ò–¶–´ –ó–ê–ì–†–£–ó–ö–ò -->
<!-- ======================================================================== -->
<div class="container mt-3">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö (–∫—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω) -->
                {% if category == 'error' %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <strong>‚ùå –û—à–∏–±–∫–∞:</strong> {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ (–∑–µ–ª–µ–Ω—ã–π —Ñ–æ–Ω) -->
                {% elif category == 'success' %}
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <strong>‚úÖ –£—Å–ø–µ—Ö:</strong> {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–∂–µ–ª—Ç—ã–π —Ñ–æ–Ω) -->
                {% elif category == 'warning' %}
                    <div class="alert alert-warning alert-dismissible fade show" role="alert">
                        <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:</strong> {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (—Å–∏–Ω–∏–π —Ñ–æ–Ω) -->
                {% else %}
                    <div class="alert alert-info alert-dismissible fade show" role="alert">
                        <strong>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endif %}
            {% endfor %}
        {% endif %}
    {% endwith %}
</div>

<!-- ======================================================================== -->
<!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† –°–¢–†–ê–ù–ò–¶–´ –ó–ê–ì–†–£–ó–ö–ò -->
<!-- ======================================================================== -->
<div class="container">
    <div class="upload-container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
        <h2 class="text-center mb-4">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h2>
        
        <!-- ================================================================ -->
        <!-- –§–û–†–ú–ê –ó–ê–ì–†–£–ó–ö–ò –§–ê–ô–õ–û–í -->
        <!-- ================================================================ -->
        <!-- 
             –§–æ—Ä–º–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤:
             - method="post" - –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–º POST
             - enctype="multipart/form-data" - –∫–æ–¥–∏—Ä–æ–≤–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
             - novalidate - –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞
             - id="uploadForm" - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è JavaScript –æ–±—Ä–∞–±–æ—Ç–∫–∏
        -->
        <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate id="uploadForm">
            <div class="mb-4">
                <!-- ======================================================== -->
                <!-- –ü–û–õ–ï –í–´–ë–û–†–ê –§–ê–ô–õ–û–í –ò –ö–ù–û–ü–ö–ê –ó–ê–ì–†–£–ó–ö–ò -->
                <!-- ======================================================== -->
                <div class="input-group">
                    <!-- 
                         –ü–æ–ª–µ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤:
                         - accept=".jpg,.jpeg,.png,.gif" - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
                         - multiple - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
                         - required - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
                    -->
                    <input type="file" class="form-control" name="file" id="file" accept=".jpg,.jpeg,.png,.gif" multiple required>
                    <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã -->
                    <button type="submit" class="btn btn-primary" id="uploadBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>
                
                <!-- ======================================================== -->
                <!-- –û–ë–©–ò–ô –ü–†–û–ì–†–ï–°–° –ó–ê–ì–†–£–ó–ö–ò -->
                <!-- ======================================================== -->
                <!-- 
                     –ë–ª–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤:
                     - –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (display: none)
                     - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
                     - –°–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∏ —Å—Ç–∞—Ç—É—Å
                -->
                <div id="overallProgress" class="mt-3" style="display: none;">
                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä -->
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="fw-bold">–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏:</span>
                        <span id="overallProgressText">0%</span>
                    </div>
                    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π -->
                    <div class="progress mb-2">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" id="overallProgressBar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <!-- –¢–µ–∫—Å—Ç–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ -->
                    <div class="text-muted small" id="overallStatus">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∑–∞–≥—Ä—É–∑–∫–µ...</div>
                </div>
                
                <!-- ======================================================== -->
                <!-- –ü–†–û–ì–†–ï–°–° –û–¢–î–ï–õ–¨–ù–´–• –§–ê–ô–õ–û–í -->
                <!-- ======================================================== -->
                <!-- 
                     –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –æ—Ç–¥–µ–ª—å–Ω–æ:
                     - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript'–æ–º
                     - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
                -->
                <div id="fileProgressContainer" class="mt-3" style="display: none;"></div>
                
                <!-- ======================================================== -->
                <!-- –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ü–û–î–î–ï–†–ñ–ò–í–ê–ï–ú–´–• –§–û–†–ú–ê–¢–ê–• -->
                <!-- ======================================================== -->
                <div class="form-text">
                    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, GIF, WebP<br>
                    –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞: 5 –ú–ë<br>
                    –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä: 50 –ú–ë<br>
                    <strong>–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</strong>
                </div>
                
                <!-- ======================================================== -->
                <!-- –°–ü–ò–°–û–ö –í–´–ë–†–ê–ù–ù–´–• –§–ê–ô–õ–û–í -->
                <!-- ======================================================== -->
                <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ñ–∞–π–ª–æ–≤ -->
                <div id="file-list" class="mt-2"></div>
                
                <!-- ======================================================== -->
                <!-- –ö–û–ù–¢–†–û–õ–¨ –û–ë–©–ï–ì–û –†–ê–ó–ú–ï–†–ê –§–ê–ô–õ–û–í -->
                <!-- ======================================================== -->
                <!-- 
                     –ë–ª–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—â–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:
                     - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ñ–∞–π–ª–æ–≤
                     - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
                -->
                <div id="totalSizeControl" class="mt-3" style="display: none;">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑–º–µ—Ä–µ -->
                    <div class="d-flex justify-content-between align-items-center p-3 border rounded">
                        <div>
                            <strong>–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:</strong>
                            <span id="totalSizeText" class="ms-2">0 MB</span>
                        </div>
                        <div>
                            <span class="text-muted small">–õ–∏–º–∏—Ç: 50 –ú–ë</span>
                        </div>
                    </div>
                    <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ -->
                    <div id="limitWarning" class="alert alert-warning mt-2" style="display: none;">
                        ‚ö†Ô∏è –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç –≤ 50 –ú–ë. –°–Ω–∏–º–∏—Ç–µ –æ—Ç–º–µ—Ç–∫–∏ —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏.
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">–°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞</label>                
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="storage_period" id="storage_15" value="15" checked>
                    <label class="form-check-label" for="storage_15">
                        15 –¥–Ω–µ–π
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="storage_period" id="storage_30" value="30">
                    <label class="form-check-label" for="storage_30">
                        30 –¥–Ω–µ–π
                    </label>
                </div>
            </div>
        </form>

        <div class="alert alert-info" role="alert">
            <h4 class="alert-heading">üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h4>
            <ol class="mb-0">
                <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã" –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ø–æ–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏</li>
                <li>–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –≤–∞—à–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (—É–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ Ctrl –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞)</li>
                <li>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤</li>
                <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ó–∞–≥—Ä—É–∑–∏—Ç—å"</li>
                <li>–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</li>
            </ol>
        </div>
    </div>
</div>

<script>
    let selectedFiles = [];
    let uploadInProgress = false;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º—ã –∏ AJAX –∑–∞–≥—Ä—É–∑–∫–∞
    document.getElementById('uploadForm').addEventListener('submit', function(event) {
        event.preventDefault();
        
        if (uploadInProgress) {
            return;
        }
        
        const form = event.target;
         const selectedFiles = getSelectedFiles();
         
         if (!form.checkValidity() || selectedFiles.length === 0) {
             form.classList.add('was-validated');
             if (selectedFiles.length === 0) {
                 // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á–µ—Ä–µ–∑ Flask flash
                 window.location.href = '/upload?error=no_files';
                 return;
             }
             return;
         }
         
         uploadFiles(selectedFiles);
    });
    
    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞–º–∏
    function uploadFiles(files) {
        uploadInProgress = true;
        const uploadBtn = document.getElementById('uploadBtn');
        const overallProgress = document.getElementById('overallProgress');
        const fileProgressContainer = document.getElementById('fileProgressContainer');
        
        // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
        uploadBtn.disabled = true;
        uploadBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>–ó–∞–≥—Ä—É–∑–∫–∞...';
        overallProgress.style.display = 'block';
        fileProgressContainer.style.display = 'block';
        
        // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞
        fileProgressContainer.innerHTML = '';
        Array.from(files).forEach((file, index) => {
            createFileProgressBar(file, index);
        });
        
        // –°–æ–∑–¥–∞–µ–º FormData —Ç–æ–ª—å–∫–æ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
         const formData = new FormData();
         files.forEach(file => {
             formData.append('file', file);
         });
        
        const storagePeriod = document.querySelector('input[name="storage_period"]:checked').value;
        formData.append('storage_period', storagePeriod);
        
        // AJAX –∑–∞–ø—Ä–æ—Å —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        const xhr = new XMLHttpRequest();
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        xhr.upload.addEventListener('progress', function(e) {
            if (e.lengthComputable) {
                const percentComplete = Math.round((e.loaded / e.total) * 100);
                updateOverallProgress(percentComplete, `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${formatBytes(e.loaded)} –∏–∑ ${formatBytes(e.total)}`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (–ø—Ä–∏–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
                updateFileProgress(files, e.loaded, e.total);
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        xhr.addEventListener('load', function() {
            if (xhr.status === 200) {
                updateOverallProgress(100, '–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
                
                // –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞
                const response = xhr.responseText;
                
                // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë
                if (response.includes('upload_success') || response.includes('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–≥—Ä—É–∑–∫–∏')) {
                    // –ó–∞–º–µ–Ω—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    document.body.innerHTML = response;
                } else {
                    // –ï—Å–ª–∏ —ç—Ç–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ upload.html, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    setTimeout(() => {
                        showSuccessNotification('–§–∞–π–ª—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
                        resetUploadForm();
                    }, 1000);
                }
            } else {
                handleUploadError('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ' + xhr.status);
            }
        });
        
        xhr.addEventListener('error', function() {
            handleUploadError('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤');
        });
        
        xhr.open('POST', '/upload');
        xhr.send(formData);
    }
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
    function createFileProgressBar(file, index) {
        const container = document.getElementById('fileProgressContainer');
        const fileDiv = document.createElement('div');
        fileDiv.className = 'mb-3 p-3 border rounded';
        fileDiv.innerHTML = `
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="fw-medium">${file.name}</span>
                <span class="text-muted small">${formatBytes(file.size)}</span>
            </div>
            <div class="progress mb-1">
                <div class="progress-bar" id="fileProgress_${index}" role="progressbar" style="width: 0%"></div>
            </div>
            <div class="text-muted small" id="fileStatus_${index}">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
        `;
        container.appendChild(fileDiv);
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    function updateOverallProgress(percent, status) {
        const progressBar = document.getElementById('overallProgressBar');
        const progressText = document.getElementById('overallProgressText');
        const statusText = document.getElementById('overallStatus');
        
        progressBar.style.width = percent + '%';
        progressText.textContent = percent + '%';
        statusText.textContent = status;
        
        if (percent === 100) {
            progressBar.classList.remove('progress-bar-animated');
            progressBar.classList.add('bg-success');
        }
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
    function updateFileProgress(files, loaded, total) {
        const avgProgress = Math.round((loaded / total) * 100);
        Array.from(files).forEach((file, index) => {
            const fileProgressBar = document.getElementById(`fileProgress_${index}`);
            const fileStatus = document.getElementById(`fileStatus_${index}`);
            
            if (fileProgressBar && fileStatus) {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç–∏
                const fileProgress = Math.min(avgProgress + Math.random() * 10 - 5, 100);
                fileProgressBar.style.width = Math.max(0, fileProgress) + '%';
                
                if (avgProgress < 100) {
                    fileStatus.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
                    fileProgressBar.className = 'progress-bar progress-bar-striped progress-bar-animated';
                } else {
                    fileStatus.textContent = '–ó–∞–≤–µ—Ä—à–µ–Ω–æ';
                    fileProgressBar.className = 'progress-bar bg-success';
                    fileProgressBar.style.width = '100%';
                }
            }
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏
    function handleUploadError(message) {
        const uploadBtn = document.getElementById('uploadBtn');
        const overallStatus = document.getElementById('overallStatus');
        const progressBar = document.getElementById('overallProgressBar');
        
        uploadBtn.disabled = false;
        uploadBtn.innerHTML = '–ó–∞–≥—Ä—É–∑–∏—Ç—å';
        uploadInProgress = false;
        
        overallStatus.textContent = message;
        progressBar.classList.remove('progress-bar-animated');
        progressBar.classList.add('bg-danger');
        
        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–≥—Ä—É–∑–∫–∏ —Å –æ—à–∏–±–∫–æ–π —á–µ—Ä–µ–∑ Flask flash
        window.location.href = '/upload?error=upload_failed&message=' + encodeURIComponent(message);
    }
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
    function formatBytes(bytes, decimals = 2) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const dm = decimals < 0 ? 0 : decimals;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
    }

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ñ–∞–π–ª–æ–≤
    let selectedFilesData = [];
    const maxFileSize = 5 * 1024 * 1024; // 5 –ú–ë
    const maxTotalSize = 50 * 1024 * 1024; // 50 –ú–ë
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏
    document.getElementById('file').addEventListener('change', function(e) {
        const files = e.target.files;
        const fileList = document.getElementById('file-list');
        const totalSizeControl = document.getElementById('totalSizeControl');
        
        // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–ø–∏—Å–æ–∫
        fileList.innerHTML = '';
        selectedFilesData = [];
        
        if (files.length === 0) {
            totalSizeControl.style.display = 'none';
            return;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—å –æ–±—â–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
        totalSizeControl.style.display = 'block';
        
        // ================================================================
        // –°–û–ó–î–ê–ù–ò–ï –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–û–ì–û –°–ü–ò–°–ö–ê –§–ê–ô–õ–û–í –° –ß–ï–ö–ë–û–ö–°–ê–ú–ò
        // –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–±–∏—Ä–∞—Ç—å –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å
        // ================================================================
        
        // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Bootstrap List Group –¥–ª—è —Ñ–∞–π–ª–æ–≤
        const listGroup = document.createElement('div');
        listGroup.className = 'list-group';
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª
        Array.from(files).forEach((file, index) => {
            // ========================================================
            // –°–û–ó–î–ê–ù–ò–ï –û–ë–™–ï–ö–¢–ê –î–ê–ù–ù–´–• –§–ê–ô–õ–ê
            // –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ –∏ –µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
            // ========================================================
            const fileData = {
                file: file,                                    // –û–±—ä–µ–∫—Ç File API
                index: index,                                // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å
                selected: file.size <= maxFileSize          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –≤–∞–ª–∏–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
            };
            selectedFilesData.push(fileData);
            
            // ========================================================
            // –°–û–ó–î–ê–ù–ò–ï HTML –≠–õ–ï–ú–ï–ù–¢–û–í –î–õ–Ø –§–ê–ô–õ–ê
            // ========================================================
            
            // –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø–∏—Å–∫–∞
            const listItem = document.createElement('div');
            listItem.className = 'list-group-item';
            
            // –ß–µ–∫–±–æ–∫—Å –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'form-check-input me-3';
            checkbox.id = `file_${index}`;
            checkbox.checked = fileData.selected;
            checkbox.disabled = file.size > maxFileSize;    // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã
            
            // –ú–µ—Ç–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ñ–∞–π–ª–µ
            const label = document.createElement('label');
            label.className = 'form-check-label d-flex justify-content-between align-items-center w-100';
            label.htmlFor = `file_${index}`;
            
            // –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–µ
            const fileInfo = document.createElement('div');
            fileInfo.className = 'd-flex align-items-center';
            
            // ========================================================
            // –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –ò–ú–ï–ù–ò –§–ê–ô–õ–ê
            // –° –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
            // ========================================================
            const fileName = document.createElement('span');
            fileName.textContent = file.name;
            // –ó–∞—á–µ—Ä–∫–∏–≤–∞–µ–º –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤, –ø—Ä–µ–≤—ã—à–∞—é—â–∏—Ö –ª–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞
            fileName.className = file.size > maxFileSize ? 'text-muted text-decoration-line-through' : '';
            
            // ========================================================
            // –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –†–ê–ó–ú–ï–†–ê –§–ê–ô–õ–ê –° –¶–í–ï–¢–û–í–û–ô –ò–ù–î–ò–ö–ê–¶–ò–ï–ô
            // ========================================================
            const fileSize = document.createElement('span');
            fileSize.className = 'badge ms-2';
            
            if (file.size > maxFileSize) {
                // –ö—Ä–∞—Å–Ω—ã–π –±–µ–π–¥–∂ –¥–ª—è —Ñ–∞–π–ª–æ–≤, –ø—Ä–µ–≤—ã—à–∞—é—â–∏—Ö –ª–∏–º–∏—Ç
                fileSize.className += ' bg-danger';
                fileSize.textContent = `${(file.size / 1024 / 1024).toFixed(2)} –ú–ë (–ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç!)`;
            } else {
                // –°–µ—Ä—ã–π –±–µ–π–¥–∂ –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
                fileSize.className += ' bg-secondary';
                fileSize.textContent = `${(file.size / 1024 / 1024).toFixed(2)} –ú–ë`;
            }
            
            // ========================================================
            // –°–ë–û–†–ö–ê HTML –°–¢–†–£–ö–¢–£–†–´
            // ========================================================
            fileInfo.appendChild(fileName);
            fileInfo.appendChild(fileSize);
            label.appendChild(fileInfo);
            
            const checkboxContainer = document.createElement('div');
            checkboxContainer.className = 'd-flex align-items-center';
            checkboxContainer.appendChild(checkbox);
            checkboxContainer.appendChild(label);
            
            listItem.appendChild(checkboxContainer);
            listGroup.appendChild(listItem);
            
            // ========================================================
            // –û–ë–†–ê–ë–û–¢–ß–ò–ö –ò–ó–ú–ï–ù–ï–ù–ò–Ø –°–û–°–¢–û–Ø–ù–ò–Ø –ß–ï–ö–ë–û–ö–°–ê
            // –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞ –∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä
            // ========================================================
            checkbox.addEventListener('change', function() {
                fileData.selected = this.checked;
                updateTotalSize();  // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä
            });
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ DOM
        fileList.appendChild(listGroup);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–∞—Å—á–µ—Ç –æ–±—â–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
        updateTotalSize();
    });
    
    /**
     * ================================================================
     * –§–£–ù–ö–¶–ò–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –û–ë–©–ï–ì–û –†–ê–ó–ú–ï–†–ê –í–´–ë–†–ê–ù–ù–´–• –§–ê–ô–õ–û–í
     * –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
     * ================================================================
     * 
     * –í—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏:
     * - –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
     * - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
     * - –û–±–Ω–æ–≤–ª—è–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
     * - –£–ø—Ä–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é –∫–Ω–æ–ø–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏
     */
    function updateTotalSize() {
        // –ü–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const totalSizeText = document.getElementById('totalSizeText');
        const limitWarning = document.getElementById('limitWarning');
        const uploadBtn = document.getElementById('uploadBtn');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—á–µ—Ç—á–∏–∫–∏
        let totalSize = 0;      // –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö
        let selectedCount = 0;  // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        
        // ========================================================
        // –ü–û–î–°–ß–ï–¢ –û–ë–©–ï–ì–û –†–ê–ó–ú–ï–†–ê –í–´–ë–†–ê–ù–ù–´–• –§–ê–ô–õ–û–í
        // ========================================================
        selectedFilesData.forEach(fileData => {
            if (fileData.selected) {
                totalSize += fileData.file.size;
                selectedCount++;
            }
        });
        
        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –º–µ–≥–∞–±–∞–π—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const totalSizeMB = totalSize / 1024 / 1024;
        const isOverLimit = totalSize > maxTotalSize;
        
        // ========================================================
        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –¢–ï–ö–°–¢–û–í–û–ì–û –ò–ù–î–ò–ö–ê–¢–û–†–ê –†–ê–ó–ú–ï–†–ê
        // ========================================================
        totalSizeText.textContent = `${totalSizeMB.toFixed(2)} –ú–ë (${selectedCount} —Ñ–∞–π–ª–æ–≤)`;
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞
        totalSizeText.className = isOverLimit ? 'ms-2 text-danger fw-bold' : 'ms-2';
        
        // ========================================================
        // –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï–ú –û –ü–†–ï–í–´–®–ï–ù–ò–ò –õ–ò–ú–ò–¢–ê
        // ========================================================
        limitWarning.style.display = isOverLimit ? 'block' : 'none';
        
        // ========================================================
        // –£–ü–†–ê–í–õ–ï–ù–ò–ï –î–û–°–¢–£–ü–ù–û–°–¢–¨–Æ –ö–ù–û–ü–ö–ò –ó–ê–ì–†–£–ó–ö–ò
        // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–∞–π–ª–æ–≤
        // ========================================================
        if (uploadBtn) {
            uploadBtn.disabled = isOverLimit || selectedCount === 0;
        }
    }
    
    /**
     * ================================================================
     * –§–£–ù–ö–¶–ò–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –ú–ê–°–°–ò–í–ê –í–´–ë–†–ê–ù–ù–´–• –§–ê–ô–õ–û–í
     * –§–∏–ª—å—Ç—Ä—É–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ—Ç–º–µ—á–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ñ–∞–π–ª—ã
     * ================================================================
     * 
     * @returns {File[]} –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ File –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
     */
    function getSelectedFiles() {
        return selectedFilesData
            .filter(fileData => fileData.selected)  // –¢–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
            .map(fileData => fileData.file);         // –ò–∑–≤–ª–µ–∫–∞–µ–º –æ–±—ä–µ–∫—Ç—ã File
    }
    
    /**
     * ================================================================
     * –§–£–ù–ö–¶–ò–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –û–ë –£–°–ü–ï–®–ù–û–ô –ó–ê–ì–†–£–ó–ö–ï
     * –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± —É—Å–ø–µ—Ö–µ
     * ================================================================
     * 
     * @param {string} message - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
     * 
     * –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å AJAX –∑–∞–≥—Ä—É–∑–∫–æ–π
     */
    function showSuccessNotification(message) {
        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å flash —Å–æ–æ–±—â–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä
        window.location.href = '/?success=' + encodeURIComponent(message);
    }
    
    /**
     * ================================================================
     * –§–£–ù–ö–¶–ò–Ø –°–ë–†–û–°–ê –§–û–†–ú–´ –ó–ê–ì–†–£–ó–ö–ò
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
     * ================================================================
     * 
     * –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—É—é –æ—á–∏—Å—Ç–∫—É:
     * - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
     * - –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É –∑–∞–≥—Ä—É–∑–∫–∏
     * - –°–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
     * - –û—á–∏—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
     * - –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫–∏ —Ä–∞–∑–º–µ—Ä–∞
     */
    function resetUploadForm() {
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
        uploadInProgress = false;
        
        // –ü–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const uploadBtn = document.getElementById('uploadBtn');
        const overallProgress = document.getElementById('overallProgress');
        const fileProgressContainer = document.getElementById('fileProgressContainer');
        const fileInput = document.getElementById('file');
        const fileList = document.getElementById('file-list');
        
        // ========================================================
        // –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï –ö–ù–û–ü–ö–ò –ó–ê–ì–†–£–ó–ö–ò
        // ========================================================
        uploadBtn.disabled = false;
        uploadBtn.innerHTML = '–ó–∞–≥—Ä—É–∑–∏—Ç—å';
        
        // ========================================================
        // –°–ö–†–´–¢–ò–ï –ü–†–û–ì–†–ï–°–°-–ò–ù–î–ò–ö–ê–¢–û–†–û–í
        // ========================================================
        overallProgress.style.display = 'none';
        fileProgressContainer.innerHTML = '';
        
        // ========================================================
        // –û–ß–ò–°–¢–ö–ê –î–ê–ù–ù–´–• –û –§–ê–ô–õ–ê–•
        // ========================================================
        fileInput.value = '';           // –û—á–∏—â–∞–µ–º input[type="file"]
        selectedFilesData = [];         // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –º–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        fileList.innerHTML = '';        // –£–¥–∞–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∏–∑ DOM
        
        // ========================================================
        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–ß–ï–¢–ß–ò–ö–û–í –ò –ò–ù–î–ò–ö–ê–¢–û–†–û–í
        // ========================================================
        updateTotalSize();  // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã (–¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å 0)
    }
</script>
{% endblock %}