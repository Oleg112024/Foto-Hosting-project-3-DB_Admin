<!-- 
============================================================================
–®–ê–ë–õ–û–ù –†–ê–°–®–ò–†–ï–ù–ù–û–ô –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–ò–í–ù–û–ô –ü–ê–ù–ï–õ–ò - –£–ì–õ–£–ë–õ–ï–ù–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê
============================================================================

–≠—Ç–æ—Ç —à–∞–±–ª–æ–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–Ω–µ–ª—å
–¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Å–∏—Å—Ç–µ–º—ã Image Hosting. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
–∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ–Ω–∏–π.

–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- –î–∞—à–±–æ—Ä–¥ —Å –∫–ª—é—á–µ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ —Å–∏—Å—Ç–µ–º—ã
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–Ω–¥–æ–≤
- –†–µ–π—Ç–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è

–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –í—ã—Å—à–∏–π —É—Ä–æ–≤–µ–Ω—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- Responsive –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –º–µ—Ç—Ä–∏–∫
- –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è
- –¢–∞–±–ª–∏—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –¥–æ—Å—Ç—É–ø:
- –°—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ –ø–∞–Ω–µ–ª–∏
- –ó–∞—â–∏—Ç–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–æ—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –±–∞–∑—ã
- –ê–Ω–∞–ª–∏–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–æ–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
- –í—ã—è–≤–ª–µ–Ω–∏–µ –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ö–æ–Ω—Ç—Ä–æ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:
- –ö–∞—Ä—Ç–æ—á–∫–∏ –º–µ—Ç—Ä–∏–∫ —Å —Ü–≤–µ—Ç–æ–≤—ã–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –¢–∞–±–ª–∏—Ü—ã —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- –ë–µ–π–¥–∂–∏ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤–∞–∂–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤
- –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π:
- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã user_statistics
- –ü–æ–¥—Å—á–µ—Ç —Ñ–∞–π–ª–æ–≤ –∏ –∏—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
- –ê–Ω–∞–ª–∏–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

============================================================================
-->

<!-- –ù–∞—Å–ª–µ–¥—É–µ–º –±–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω —Å –æ–±—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π -->
{% extends 'base.html' %}

<!-- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏ -->
{% block title %}–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –§–æ—Ç–æ –•–æ—Å—Ç–∏–Ω–≥{% endblock %}

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª–∏ -->
{% block content %}
<!-- ========================================================================
     –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† –†–ê–°–®–ò–†–ï–ù–ù–û–ô –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–ò–í–ù–û–ô –ü–ê–ù–ï–õ–ò
     ======================================================================== -->
<div class="container mt-4">
    <!-- ====================================================================
         –ó–ê–ì–û–õ–û–í–û–ö –° –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–´–ú –£–†–û–í–ù–ï–ú –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò
         –ò–Ω–¥–∏–∫–∞—Ü–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
         ==================================================================== -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–∫–æ–Ω–∫–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ -->
        <h2 class="text-danger">üîí –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <!-- –ë–µ–π–¥–∂ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è –¥–æ—Å—Ç—É–ø–∞ -->
        <span class="badge bg-danger">ADMIN ONLY</span>
    </div>
    <div class="alert alert-info mb-4">
        <i class="fas fa-info-circle"></i>
        <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –î–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–∏—Å—Ç–µ–º—ã –∏ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º.
    </div>
    
    <!-- ====================================================================
         –î–ê–®–ë–û–†–î –ö–õ–Æ–ß–ï–í–´–• –ú–ï–¢–†–ò–ö –°–ò–°–¢–ï–ú–´
         –û–±–∑–æ—Ä –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
         ==================================================================== -->
    <div class="row mb-4">
        <!-- ============================================================
             –ú–ï–¢–†–ò–ö–ê: –û–ë–©–ï–ï –ö–û–õ–ò–ß–ï–°–¢–í–û –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô
             –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å —Ä–æ—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –±–∞–∑—ã
             ============================================================ -->
        <div class="col-md-2">
            <div class="card text-center bg-primary text-white">
                <div class="card-body">
                    <h6 class="card-title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h6>
                    <h3>{{ total_users }}</h3>
                </div>
            </div>
        </div>
        
        <!-- ============================================================
             –ú–ï–¢–†–ò–ö–ê: –û–ë–©–ï–ï –ö–û–õ–ò–ß–ï–°–¢–í–û –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô
             –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å –æ–±—ä–µ–º–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º–µ
             –¶–≤–µ—Ç: –ó–µ–ª–µ–Ω—ã–π (bg-success) - –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–π —Ä–æ—Å—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞
             –î–∞–Ω–Ω—ã–µ: –ü–æ–ª—É—á–∞—é—Ç—Å—è –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ get_total_images() –≤ db.py
             ============================================================ -->
        <div class="col-md-2"> <!-- –ö–æ–ª–æ–Ω–∫–∞ —à–∏—Ä–∏–Ω–æ–π 2/12 –æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ -->
            <div class="card text-center bg-success text-white"> <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –∑–µ–ª–µ–Ω—ã–º —Ñ–æ–Ω–æ–º –∏ –±–µ–ª—ã–º —Ç–µ–∫—Å—Ç–æ–º -->
                <div class="card-body"> <!-- –¢–µ–ª–æ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏ -->
                    <h6 class="card-title">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h6> <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ—Ç—Ä–∏–∫–∏ -->
                    <h3>{{ total_images }}</h3> <!-- –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ Flask -->
                </div>
            </div>
        </div>
        
        <!-- ============================================================
             –ú–ï–¢–†–ò–ö–ê: –û–ë–©–ï–ï –ö–û–õ–ò–ß–ï–°–¢–í–û –ó–ê–ì–†–£–ó–û–ö
             –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∑–∞–≥—Ä—É–∑–∫–µ
             –¶–≤–µ—Ç: –°–∏–Ω–∏–π (bg-info) - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
             –î–∞–Ω–Ω—ã–µ: –ü–æ–¥—Å—á–µ—Ç –∑–∞–ø–∏—Å–µ–π —Å action_type='—É—Å–ø–µ—à–Ω–∞—è_–∑–∞–≥—Ä—É–∑–∫–∞'
             ============================================================ -->
        <div class="col-md-2"> <!-- –ö–æ–ª–æ–Ω–∫–∞ –¥–ª—è –º–µ—Ç—Ä–∏–∫–∏ –∑–∞–≥—Ä—É–∑–æ–∫ -->
            <div class="card text-center bg-info text-white"> <!-- –°–∏–Ω—è—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö -->
                <div class="card-body"> <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
                    <h6 class="card-title">–ó–∞–≥—Ä—É–∑–∫–∏</h6> <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ -->
                    <h3>{{ total_uploads }}</h3> <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ admin_app.py -->
                </div>
            </div>
        </div>
        
        <!-- ============================================================
             –ú–ï–¢–†–ò–ö–ê: –û–ë–©–ï–ï –ö–û–õ–ò–ß–ï–°–¢–í–û –ü–†–û–°–ú–û–¢–†–û–í
             –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
             –¶–≤–µ—Ç: –ñ–µ–ª—Ç—ã–π (bg-warning) - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–∏–π –æ –Ω–∞–≥—Ä—É–∑–∫–µ
             –î–∞–Ω–Ω—ã–µ: –ü–æ–¥—Å—á–µ—Ç –∑–∞–ø–∏—Å–µ–π —Å action_type='–ø—Ä–æ—Å–º–æ—Ç—Ä_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è'
             ============================================================ -->
        <div class="col-md-2"> <!-- –ö–æ–ª–æ–Ω–∫–∞ –¥–ª—è –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ -->
            <div class="card text-center bg-warning text-white"> <!-- –ñ–µ–ª—Ç–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–∏—Ö –º–µ—Ç—Ä–∏–∫ -->
                <div class="card-body"> <!-- –¢–µ–ª–æ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º -->
                    <h6 class="card-title">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</h6> <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ -->
                    <h3>{{ total_views }}</h3> <!-- –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ -->
                </div>
            </div>
        </div>
        
        <!-- ============================================================
             –ú–ï–¢–†–ò–ö–ê: –û–ë–©–ï–ï –ö–û–õ–ò–ß–ï–°–¢–í–û –°–ö–ê–ß–ò–í–ê–ù–ò–ô
             –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
             –¶–≤–µ—Ç: –ö—Ä–∞—Å–Ω—ã–π (bg-danger) - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
             –î–∞–Ω–Ω—ã–µ: –ü–æ–¥—Å—á–µ—Ç –∑–∞–ø–∏—Å–µ–π —Å action_type='download'
             ============================================================ -->
        <div class="col-md-2"> <!-- –ö–æ–ª–æ–Ω–∫–∞ –¥–ª—è –º–µ—Ç—Ä–∏–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π -->
            <div class="card text-center bg-danger text-white"> <!-- –ö—Ä–∞—Å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫ -->
                <div class="card-body"> <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ -->
                    <h6 class="card-title">–°–∫–∞—á–∏–≤–∞–Ω–∏—è</h6> <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π -->
                    <h3>{{ total_downloads }}</h3> <!-- –ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ get_total_downloads() -->
                </div>
            </div>
        </div>
        
        <!-- ============================================================
             –ú–ï–¢–†–ò–ö–ê: –û–ë–©–ò–ô –†–ê–ó–ú–ï–† –§–ê–ô–õ–û–í
             –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
             –¶–≤–µ—Ç: –¢–µ–º–Ω—ã–π (bg-dark) - —Å–µ—Ä—å–µ–∑–Ω–∞—è —Å–∏—Å—Ç–µ–º–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞
             –î–∞–Ω–Ω—ã–µ: –°—É–º–º–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ get_total_files_size()
             ============================================================ -->
        <div class="col-md-2"> <!-- –ö–æ–ª–æ–Ω–∫–∞ –¥–ª—è –º–µ—Ç—Ä–∏–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ -->
            <div class="card text-center bg-dark text-white"> <!-- –¢–µ–º–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ -->
                <div class="card-body"> <!-- –¢–µ–ª–æ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
                    <h6 class="card-title">–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä</h6> <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ—Ç—Ä–∏–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ -->
                    <h3>{{ total_files_size }}</h3> <!-- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- ====================================================================
         –í–¢–û–†–ê–Ø –°–¢–†–û–ö–ê –ê–ù–ê–õ–ò–¢–ò–ß–ï–°–ö–ò–• –ü–ê–ù–ï–õ–ï–ô
         –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø–µ—Ä–∏–æ–¥–∞–º –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
         ==================================================================== -->
    <div class="row"> <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Ç–æ—Ä–æ–π —Å—Ç—Ä–æ–∫–∏ –ø–∞–Ω–µ–ª–µ–π -->
        <!-- ============================================================
             –ü–ê–ù–ï–õ–¨: –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û –î–ù–Ø–ú
             –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤ –∑–∞–≥—Ä—É–∑–æ–∫ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é
             –ü–æ–º–æ–≥–∞–µ—Ç –≤—ã—è–≤–∏—Ç—å –ø–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã
             ============================================================ -->
        <div class="col-md-6"> <!-- –õ–µ–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ —ç–∫—Ä–∞–Ω–∞ –¥–ª—è –¥–Ω–µ–≤–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
            <div class="card"> <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
                <div class="card-header"> <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
                    <h5>–ó–∞–≥—Ä—É–∑–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</h5> <!-- –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ -->
                </div>
                <div class="card-body"> <!-- –¢–µ–ª–æ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ -->
                    {% if daily_uploads %} <!-- –£—Å–ª–æ–≤–∏–µ: –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–≥—Ä—É–∑–∫–∞—Ö -->
                    <table class="table table-sm"> <!-- –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ Bootstrap -->
                        <thead> <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã -->
                            <tr> <!-- –°—Ç—Ä–æ–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ -->
                                <th>–î–∞—Ç–∞</th> <!-- –ö–æ–ª–æ–Ω–∫–∞ –¥–∞—Ç—ã -->
                                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th> <!-- –ö–æ–ª–æ–Ω–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–≥—Ä—É–∑–æ–∫ -->
                            </tr>
                        </thead>
                        <tbody> <!-- –¢–µ–ª–æ —Ç–∞–±–ª–∏—Ü—ã —Å –¥–∞–Ω–Ω—ã–º–∏ -->
                            {% for upload in daily_uploads %} <!-- –¶–∏–∫–ª –ø–æ –¥–Ω—è–º —Å –∑–∞–≥—Ä—É–∑–∫–∞–º–∏ -->
                            <tr> <!-- –°—Ç—Ä–æ–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è -->
                                <td>{{ upload[0] }}</td> <!-- –î–∞—Ç–∞ (–ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –∫–æ—Ä—Ç–µ–∂–∞) -->
                                <td><span class="badge bg-primary">{{ upload[1] }}</span></td> <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ —Å–∏–Ω–µ–º –±–µ–π–¥–∂–µ -->
                            </tr>
                            {% endfor %} <!-- –ö–æ–Ω–µ—Ü —Ü–∏–∫–ª–∞ –ø–æ –¥–Ω—è–º -->
                        </tbody>
                    </table>
                    {% else %} <!-- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö -->
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</p> <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö -->
                    {% endif %} <!-- –ö–æ–Ω–µ—Ü —É—Å–ª–æ–≤–∏—è -->
                </div>
            </div>
        </div>
        
        <!-- ============================================================
             –ü–ê–ù–ï–õ–¨: –¢–û–ü –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô –ü–û –ê–ö–¢–ò–í–ù–û–°–¢–ò
             –†–µ–π—Ç–∏–Ω–≥ –Ω–∞–∏–±–æ–ª–µ–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º—ã
             –ü–æ–º–æ–≥–∞–µ—Ç –≤—ã—è–≤–∏—Ç—å VIP-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ
             ============================================================ -->
        <div class="col-md-6"> <!-- –ü—Ä–∞–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ —ç–∫—Ä–∞–Ω–∞ –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div class="card"> <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
                <div class="card-header"> <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
                    <h5>–¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∑–∞–≥—Ä—É–∑–∫–∞–º</h5> <!-- –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
                </div>
                <div class="card-body"> <!-- –¢–µ–ª–æ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º -->
                    {% if top_users %} <!-- –£—Å–ª–æ–≤–∏–µ: –µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö -->
                    <table class="table table-sm"> <!-- –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
                        <thead> <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
                            <tr> <!-- –°—Ç—Ä–æ–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ -->
                                <th>Email</th> <!-- –ö–æ–ª–æ–Ω–∫–∞ email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                                <th>–ó–∞–≥—Ä—É–∑–∫–∏</th> <!-- –ö–æ–ª–æ–Ω–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–≥—Ä—É–∑–æ–∫ -->
                            </tr>
                        </thead>
                        <tbody> <!-- –¢–µ–ª–æ —Ç–∞–±–ª–∏—Ü—ã —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º -->
                            {% for user in top_users %} <!-- –¶–∏–∫–ª –ø–æ —Ç–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º -->
                            <tr> <!-- –°—Ç—Ä–æ–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
                                <td>{{ user[0] }}</td> <!-- Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç) -->
                                <td><span class="badge bg-success">{{ user[1] }}</span></td> <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∑–æ–∫ –≤ –∑–µ–ª–µ–Ω–æ–º –±–µ–π–¥–∂–µ -->
                            </tr>
                            {% endfor %} <!-- –ö–æ–Ω–µ—Ü —Ü–∏–∫–ª–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º -->
                        </tbody>
                    </table>
                    {% else %} <!-- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö</p> <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö -->
                    {% endif %} <!-- –ö–æ–Ω–µ—Ü —É—Å–ª–æ–≤–∏—è -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5>–î–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h5>
                        <span class="badge bg-secondary">{{ total_records }} –∑–∞–ø–∏—Å–µ–π</span>
                    </div>
                </div>
                <div class="card-body">
                    <!-- –§–∏–ª—å—Ç—Ä—ã -->
                    <form method="GET" class="mb-3">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <label for="action_type" class="form-label">–¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è:</label>
                                <select name="action_type" id="action_type" class="form-select">
                                    <option value="">–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è</option>
                                    {% for action in action_types %}
                                    <option value="{{ action }}" {% if action == current_action_type %}selected{% endif %}>
                                        {% if action == '—É—Å–ø–µ—à–Ω–∞—è_–∑–∞–≥—Ä—É–∑–∫–∞' %}–ó–∞–≥—Ä—É–∑–∫–∞
                                        {% elif action == '–ø—Ä–æ—Å–º–æ—Ç—Ä_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è' %}–ü—Ä–æ—Å–º–æ—Ç—Ä
                                        {% elif action == 'download' %}–°–∫–∞—á–∏–≤–∞–Ω–∏–µ
                                        {% elif action == '–ø–æ–ø—ã—Ç–∫–∞_–≤—Ö–æ–¥–∞' %}–ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞
                                        {% elif action == '—É—Å–ø–µ—à–Ω—ã–π_–≤—Ö–æ–¥' %}–í—Ö–æ–¥
                                        {% elif action == '–Ω–µ—É–¥–∞—á–Ω—ã–π_–≤—Ö–æ–¥' %}–ù–µ—É–¥–∞—á–Ω—ã–π –≤—Ö–æ–¥
                                        {% elif action == '—É—Å–ø–µ—à–Ω–æ–µ_—É–¥–∞–ª–µ–Ω–∏–µ' %}–£–¥–∞–ª–µ–Ω–∏–µ
                                        {% elif action == 'login' %}–í—Ö–æ–¥
                                        {% elif action == 'register' %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                                        {% elif action == '—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                                        {% elif action == '–Ω–µ—É–¥–∞—á–Ω–∞—è_—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' %}–ù–µ—É–¥–∞—á–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                                        {% elif action == '—É—Å–ø–µ—à–Ω–∞—è_—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è_–∞–¥–º–∏–Ω–∞' %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–¥–º–∏–Ω–∞
                                        {% elif action == '–Ω–µ—É–¥–∞—á–Ω–∞—è_—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è_–∞–¥–º–∏–Ω–∞' %}–ù–µ—É–¥–∞—á–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–¥–º–∏–Ω–∞
                                        {% elif action == '–≥–ª–∞–≤–Ω–∞—è_—Å—Ç—Ä–∞–Ω–∏—Ü–∞' %}–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
                                        {% else %}{{ action }}
                                        {% endif %}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</label>
                                
                                <!-- –ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
                                <div class="quick-filters mb-2">
                                    <button type="button" class="btn btn-sm btn-outline-secondary active" data-filter="all">–í—Å–µ</button>
                                    <button type="button" class="btn btn-sm btn-outline-primary" data-filter="admin">–ê–¥–º–∏–Ω—ã</button>
                                    <button type="button" class="btn btn-sm btn-outline-success" data-filter="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</button>
                                </div>
                                
                                <!-- –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º -->
                                <div class="position-relative">
                                    <input type="text" id="user_search_enhanced" class="form-control" 
                                           placeholder="üîç –í–≤–µ–¥–∏—Ç–µ email –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞..." autocomplete="off">
                                    <div class="autocomplete-dropdown" id="user_suggestions" style="display: none;"></div>
                                </div>
                                
                                <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
                                <input type="hidden" name="user_email" id="selected_user_value" value="{{ current_user_email or '' }}">
                                
                                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
                                <div class="selected-user-info mt-2" id="user_info" style="{% if not current_user_email %}display: none;{% endif %}">
                                    <small class="text-muted">
                                        <span class="badge bg-info">–í—ã–±—Ä–∞–Ω:</span>
                                        <span id="user_info_text">
                                            {% if current_user_email == 'ACTIVE_USERS' %}
                                                üë• –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                                            {% elif current_user_email and current_user_email.startswith('CUSTOM_LIST:') %}
                                                üë• –í—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: {{ current_user_email[12:].replace(',', ', ') }}
                                            {% elif current_user_email %}
                                                {{ current_user_email }}
                                            {% else %}
                                                –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                                            {% endif %}
                                        </span>
                                        <p>
                                            
                                        </p>
                                        <button type="button" class="btn btn-sm btn-outline-danger ms-2" id="clear_user">–û—Ç–º–µ–Ω–∞</button>
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label for="per_page" class="form-label">–ó–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:</label>
                                <select name="per_page" id="per_page" class="form-select">
                                    <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                                    <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
                                    <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                                    <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">&nbsp;</label>
                                <div>
                                    <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">&nbsp;</label>
                                <div>
                                    <a href="{{ url_for('admin_statistics_route') }}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
                                </div>
                            </div>
                        </div>
                    </form>
                    
                    {% if recent_actions %}
                    <div class="table-responsive">
                        <table class="table table-sm table-striped">
                            <thead>
                                <tr>
                                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>IP –∞–¥—Ä–µ—Å</th>
                                    <th>–í—Ä–µ–º—è</th>
                                    <th>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for action in recent_actions %}
                                <tr>
                                    <td>
                                        {% if action.action_type == '—É—Å–ø–µ—à–Ω–∞—è_–∑–∞–≥—Ä—É–∑–∫–∞' %}
                                            <span class="badge bg-success">–ó–∞–≥—Ä—É–∑–∫–∞</span>
                                        {% elif action.action_type == '–ø—Ä–æ—Å–º–æ—Ç—Ä_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è' %}
                                            <span class="badge bg-info">–ü—Ä–æ—Å–º–æ—Ç—Ä</span>
                                        {% elif action.action_type == 'download' %}
                                            <span class="badge bg-danger">–°–∫–∞—á–∏–≤–∞–Ω–∏–µ</span>
                                        {% elif action.action_type == '–ø–æ–ø—ã—Ç–∫–∞_–≤—Ö–æ–¥–∞' %}
                                            <span class="badge bg-warning">–ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞</span>
                                        {% elif action.action_type == '—É—Å–ø–µ—à–Ω—ã–π_–≤—Ö–æ–¥' %}
                                            <span class="badge bg-primary">–í—Ö–æ–¥</span>
                                        {% elif action.action_type == '–Ω–µ—É–¥–∞—á–Ω—ã–π_–≤—Ö–æ–¥' %}
                                            <span class="badge bg-danger">–ù–µ—É–¥–∞—á–Ω—ã–π –≤—Ö–æ–¥</span>
                                        {% elif action.action_type == '—É—Å–ø–µ—à–Ω–æ–µ_—É–¥–∞–ª–µ–Ω–∏–µ' %}
                                            <span class="badge" style="background-color: #fd7e14; color: white;">–£–¥–∞–ª–µ–Ω–∏–µ</span>
                                        {% elif action.action_type == 'login' %}
                                            <span class="badge bg-primary">–í—Ö–æ–¥</span>
                                        {% elif action.action_type == 'register' %} <!-- - üü° –ñ–µ–ª—Ç—ã–π —Ü–≤–µ—Ç —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ. –≠—Ç–æ —Å—Ç–∞—Ä–æ–µ –∞–Ω–≥–ª. –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ –¥–µ–π—Å—Ç–≤–∏—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ –ë–î -->
                                            <span class="badge bg-warning">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span>
                                        {% elif action.action_type == '—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' %} <!-- üü¢ –ó–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —É—Å–ø–µ—à–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ. –≠—Ç–æ –Ω–æ–≤–æ–µ —Ä—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ –¥–µ–π—Å—Ç–≤–∏—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ —Å–∏—Å—Ç–µ–º—ã –≤ –ë–î. –û—Å–Ω–æ–≤–Ω–æ–π —Ç–∏–ø –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                                            <span class="badge bg-success">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span>
                                        {% elif action.action_type == '–Ω–µ—É–¥–∞—á–Ω–∞—è_—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è' %}
                                            <span class="badge bg-danger">–ù–µ—É–¥–∞—á–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</span>
                                        {% elif action.action_type == '—É—Å–ø–µ—à–Ω–∞—è_—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è_–∞–¥–º–∏–Ω–∞' %}
                                            <span class="badge" style="background-color: #6f42c1; color: white;">üîê –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–¥–º–∏–Ω–∞</span>
                                        {% elif action.action_type == '–Ω–µ—É–¥–∞—á–Ω–∞—è_—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è_–∞–¥–º–∏–Ω–∞' %}
                                            <span class="badge" style="background-color: #dc3545; color: white;">‚ö†Ô∏è –ù–µ—É–¥–∞—á–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–¥–º–∏–Ω–∞</span>
                                        {% elif action.action_type == '–≥–ª–∞–≤–Ω–∞—è_—Å—Ç—Ä–∞–Ω–∏—Ü–∞' %}
                                            <span class="badge bg-light text-dark">üè† –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</span>
                                        {% else %}
                                            <span class="badge bg-secondary">{{ action.action_type }}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ action.user_email or '-' }}</td>
                                    <td><code>{{ action.ip_address or '-' }}</code></td>
                                    <td>{{ action.timestamp.strftime('%d.%m.%Y %H:%M:%S') }}</td>
                                    <td><small class="text-muted">{{ action.additional_info or '-' }}</small></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                    {% if total_pages > 1 %}
                    <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º" class="mt-3">
                        <ul class="pagination justify-content-center">
                            <!-- –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
                            {% if current_page > 1 %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('admin_statistics_route', page=current_page-1, action_type=current_action_type, user_email=current_user_email, per_page=per_page) }}">
                                    &laquo; –ü—Ä–µ–¥—ã–¥—É—â–∞—è
                                </a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">&laquo; –ü—Ä–µ–¥—ã–¥—É—â–∞—è</span>
                            </li>
                            {% endif %}
                            
                            <!-- –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü -->
                            {% set start_page = [1, current_page - 2]|max %}
                            {% set end_page = [total_pages, current_page + 2]|min %}
                            
                            {% if start_page > 1 %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('admin_statistics_route', page=1, action_type=current_action_type, user_email=current_user_email, per_page=per_page) }}">1</a>
                            </li>
                            {% if start_page > 2 %}
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                            {% endif %}
                            {% endif %}
                            
                            {% for page_num in range(start_page, end_page + 1) %}
                            <li class="page-item {% if page_num == current_page %}active{% endif %}">
                                <a class="page-link" href="{{ url_for('admin_statistics_route', page=page_num, action_type=current_action_type, user_email=current_user_email, per_page=per_page) }}">{{ page_num }}</a>
                            </li>
                            {% endfor %}
                            
                            {% if end_page < total_pages %}
                            {% if end_page < total_pages - 1 %}
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                            {% endif %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('admin_statistics_route', page=total_pages, action_type=current_action_type, user_email=current_user_email, per_page=per_page) }}">{{ total_pages }}</a>
                            </li>
                            {% endif %}
                            
                            <!-- –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
                            {% if current_page < total_pages %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('admin_statistics_route', page=current_page + 1, action_type=current_action_type, user_email=current_user_email, per_page=per_page) }}">
                                    –°–ª–µ–¥—É—é—â–∞—è &raquo;
                                </a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <span class="page-link">–°–ª–µ–¥—É—é—â–∞—è &raquo;</span>
                            </li>
                            {% endif %}
                        </ul>
                    </nav>
                    
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ -->
                    <div class="text-center text-muted mt-2">
                        <small>
                            –ü–æ–∫–∞–∑–∞–Ω–æ {{ (current_page - 1) * per_page + 1 }} - {{ [current_page * per_page, total_records]|min }} –∏–∑ {{ total_records }} –∑–∞–ø–∏—Å–µ–π
                            (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ {{ current_page }} –∏–∑ {{ total_pages }})
                        </small>
                    </div>
                    {% endif %}
                    
                    {% else %}
                    <p class="text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –¥–µ–π—Å—Ç–≤–∏—è—Ö</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="mt-4">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>
</div>

<style>
.quick-filters .btn {
    margin-right: 5px;
    margin-bottom: 5px;
}

.autocomplete-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border: 1px solid #ced4da;
    border-top: none;
    border-radius: 0 0 0.375rem 0.375rem;
    max-height: 200px;
    overflow-y: auto;
    z-index: 1000;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.autocomplete-item {
    padding: 8px 12px;
    cursor: pointer;
    border-bottom: 1px solid #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.autocomplete-item:hover,
.autocomplete-item.highlighted {
    background-color: #e9ecef;
}

.autocomplete-item:last-child {
    border-bottom: none;
}

.user-email {
    font-weight: 500;
    color: #495057;
}

.user-badge {
    font-size: 0.75rem;
}

.no-results {
    padding: 12px;
    text-align: center;
    color: #6c757d;
    font-style: italic;
}

.selected-user-info {
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
}

.user-tag {
    display: inline-flex;
    align-items: center;
    padding: 0.25rem 0.5rem;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    background-color: #e9ecef;
    color: #495057;
}

.user-tag .btn-close {
    font-size: 0.75rem;
    padding: 0;
    margin: 0;
    width: 1rem;
    height: 1rem;
}

.user-tag:hover {
    background-color: #dee2e6;
}

.user-checkbox-item {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    padding: 0.25rem 0.5rem;
    margin: 0.125rem;
}

.user-checkbox-item:hover {
    background-color: #e9ecef;
}

.user-checkbox-item input[type="checkbox"] {
    margin-right: 0.25rem;
}

.user-label {
    margin-bottom: 0;
    cursor: pointer;
    font-size: 0.875rem;
}

.user-checkbox-item input[type="checkbox"]:checked + .user-label {
    text-decoration: line-through;
    color: #6c757d;
}
</style>

<script>
// –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º
class EnhancedUserSearch {
    constructor() {
        this.users = {{ users|tojson }}; // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —à–∞–±–ª–æ–Ω–∞
        this.filteredUsers = [...this.users];
        this.selectedUser = '{{ current_user_email or "" }}';
        this.currentFilter = 'all';
        this.highlightedIndex = -1;
        this.init();
    }
    
    init() {
        this.bindEvents();
        this.setupQuickFilters();
        this.initializeDisplay();
    }
    
    bindEvents() {
        const searchInput = document.getElementById('user_search_enhanced');
        const suggestionsDiv = document.getElementById('user_suggestions');
        const clearBtn = document.getElementById('clear_user');
        
        // –ü–æ–∏—Å–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ
        searchInput.addEventListener('input', (e) => {
            this.search(e.target.value);
        });
        
        // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
        searchInput.addEventListener('keydown', (e) => {
            this.handleKeydown(e);
        });
        
        // –°–∫—Ä—ã—Ç–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.position-relative')) {
                this.hideSuggestions();
            }
        });
        
        // –û—á–∏—Å—Ç–∫–∞ –≤—ã–±–æ—Ä–∞
        clearBtn.addEventListener('click', () => {
            this.clearSelection();
        });
        
        // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
        searchInput.addEventListener('focus', () => {
            if (searchInput.value.trim() === '') {
                this.showAllSuggestions();
            }
        });
    }
    
    setupQuickFilters() {
        const filterButtons = document.querySelectorAll('.quick-filters .btn');
        
        filterButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                filterButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä
                const filter = btn.dataset.filter;
                this.applyQuickFilter(filter);
            });
        });
    }
    
    applyQuickFilter(filter) {
        this.currentFilter = filter;
        const searchInput = document.getElementById('user_search_enhanced');
        const hiddenInput = document.getElementById('selected_user_value');
        
        switch(filter) {
            case 'admin':
                // –§–∏–ª—å—Ç—Ä –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å admin –≤ email)
                this.filteredUsers = this.users.filter(user => 
                    user.toLowerCase().includes('admin')
                );
                break;
            case 'active':
                // –§–∏–ª—å—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Å example.com –∏ –Ω–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã)
                this.filteredUsers = this.users.filter(user => 
                    !user.includes('example.com') && !user.toLowerCase().includes('admin')
                );
                break;
            default:
                this.filteredUsers = [...this.users];
        }
        
        // –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ñ–∏–ª—å—Ç—Ä–∞
        if (filter === 'admin' && this.filteredUsers.length > 0) {
            // –î–ª—è –∞–¥–º–∏–Ω–æ–≤ —Å–æ–∑–¥–∞–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫
            this.createInteractiveUserList(this.filteredUsers, '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã');
        } else if (filter === 'active') {
            // –î–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            this.selectUser('ACTIVE_USERS');
        } else if (filter === 'all') {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –≤—Å–µ—Ö (–±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã)
            this.selectUser('');
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –µ—Å–ª–∏ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –≤ —Ñ–æ–∫—É—Å–µ
        if (document.activeElement === searchInput) {
            this.search(searchInput.value);
        }
    }
    
    search(query) {
        const trimmedQuery = query.trim().toLowerCase();
        
        if (trimmedQuery === '') {
            this.showAllSuggestions();
            return;
        }
        
        const results = this.filteredUsers.filter(user => 
            user.toLowerCase().includes(trimmedQuery)
        );
        
        // –î–æ–±–∞–≤–ª—è–µ–º "–ì–æ—Å—Ç—å" –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –µ—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç
        const guestResults = [];
        if ('–≥–æ—Å—Ç—å'.includes(trimmedQuery) || 'guest'.includes(trimmedQuery) || '–∞–Ω–æ–Ω–∏–º–Ω—ã–µ'.includes(trimmedQuery)) {
            guestResults.push('–ì–æ—Å—Ç—å');
        }
        
        this.showSuggestions([...guestResults, ...results], trimmedQuery);
    }
    
    showAllSuggestions() {
        this.showSuggestions(this.filteredUsers.slice(0, 10)); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 10
    }
    
    showSuggestions(users, query = '') {
        const suggestionsDiv = document.getElementById('user_suggestions');
        this.highlightedIndex = -1;
        
        if (users.length === 0) {
            suggestionsDiv.innerHTML = '<div class="no-results">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
            suggestionsDiv.style.display = 'block';
            return;
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–ø—Ü–∏—é "–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" –µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
        let html = '';
        if (query === '') {
            html += `
                <div class="autocomplete-item" data-value="">
                    <span class="user-email">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                    <span class="badge bg-secondary user-badge">–í—Å–µ</span>
                </div>
                <div class="autocomplete-item" data-value="–ì–æ—Å—Ç—å">
                    <span class="user-email">üë• –ì–æ—Å—Ç—å</span>
                    <span class="badge bg-light text-dark user-badge">–ê–Ω–æ–Ω–∏–º–Ω—ã–µ</span>
                </div>
            `;
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        users.forEach(user => {
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è "–ì–æ—Å—Ç—å"
            if (user === '–ì–æ—Å—Ç—å') {
                let displayText = 'üë• –ì–æ—Å—Ç—å';
                if (query) {
                    const regex = new RegExp(`(${query})`, 'gi');
                    displayText = displayText.replace(regex, '<mark>$1</mark>');
                }
                html += `
                    <div class="autocomplete-item" data-value="–ì–æ—Å—Ç—å">
                        <span class="user-email">${displayText}</span>
                        <span class="badge bg-light text-dark user-badge">–ê–Ω–æ–Ω–∏–º–Ω—ã–µ</span>
                    </div>
                `;
                return;
            }
            
            const isAdmin = user.toLowerCase().includes('admin');
            const badgeClass = isAdmin ? 'bg-warning' : 'bg-info';
            const badgeText = isAdmin ? '–ê–¥–º–∏–Ω' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
            let displayEmail = user;
            if (query) {
                const regex = new RegExp(`(${query})`, 'gi');
                displayEmail = user.replace(regex, '<mark>$1</mark>');
            }
            
            html += `
                <div class="autocomplete-item" data-value="${user}">
                    <span class="user-email">${displayEmail}</span>
                    <span class="badge ${badgeClass} user-badge">${badgeText}</span>
                </div>
            `;
        });
        
        suggestionsDiv.innerHTML = html;
        suggestionsDiv.style.display = 'block';
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤
        suggestionsDiv.querySelectorAll('.autocomplete-item').forEach((item, index) => {
            item.addEventListener('click', () => {
                this.selectUser(item.dataset.value);
            });
        });
    }
    
    hideSuggestions() {
        const suggestionsDiv = document.getElementById('user_suggestions');
        suggestionsDiv.style.display = 'none';
        this.highlightedIndex = -1;
    }
    
    handleKeydown(e) {
        const suggestionsDiv = document.getElementById('user_suggestions');
        const items = suggestionsDiv.querySelectorAll('.autocomplete-item');
        
        switch(e.key) {
            case 'ArrowDown':
                e.preventDefault();
                this.highlightedIndex = Math.min(this.highlightedIndex + 1, items.length - 1);
                this.updateHighlight(items);
                break;
            case 'ArrowUp':
                e.preventDefault();
                this.highlightedIndex = Math.max(this.highlightedIndex - 1, -1);
                this.updateHighlight(items);
                break;
            case 'Enter':
                e.preventDefault();
                if (this.highlightedIndex >= 0 && items[this.highlightedIndex]) {
                    this.selectUser(items[this.highlightedIndex].dataset.value);
                }
                break;
            case 'Escape':
                this.hideSuggestions();
                break;
        }
    }
    
    updateHighlight(items) {
        items.forEach((item, index) => {
            item.classList.toggle('highlighted', index === this.highlightedIndex);
        });
    }
    
    selectUser(userEmail) {
        const searchInput = document.getElementById('user_search_enhanced');
        const hiddenInput = document.getElementById('selected_user_value');
        const userInfo = document.getElementById('user_info');
        const userInfoText = document.getElementById('user_info_text');
        
        this.selectedUser = userEmail;
        hiddenInput.value = userEmail;
        
        if (userEmail === '') {
            searchInput.value = '';
            userInfo.style.display = 'none';
        } else if (userEmail === 'ACTIVE_USERS') {
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö email
            const activeUsers = this.users.filter(user => 
                !user.includes('example.com') && !user.toLowerCase().includes('admin')
            );
            
            if (activeUsers.length > 0) {
                // –°–æ–∑–¥–∞–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∏—è
                this.createInteractiveUserList(activeUsers, '–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏');
            } else {
                searchInput.value = '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π';
                userInfoText.textContent = '–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π';
                userInfo.style.display = 'block';
            }
        } else {
            searchInput.value = userEmail;
            userInfoText.textContent = userEmail;
            userInfo.style.display = 'block';
        }
        
        this.hideSuggestions();
    }
    
    clearSelection() {
        this.selectUser('');
    }
    
    createInteractiveUserList(users, title) {
        const searchInput = document.getElementById('user_search_enhanced');
        const userInfo = document.getElementById('user_info');
        const userInfoText = document.getElementById('user_info_text');
        const hiddenInput = document.getElementById('selected_user_value');
        
        // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        this.currentUserList = [...users];
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        if (users.length > 0) {
            hiddenInput.value = `CUSTOM_LIST:${users.join(',')}`;
        } else {
            hiddenInput.value = '';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        this.updateUserListDisplay(title);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
        setTimeout(() => {
            this.updateUserSelection();
        }, 100);
        
        userInfo.style.display = 'block';
    }
    
    updateUserListDisplay(title) {
        const searchInput = document.getElementById('user_search_enhanced');
        const userInfoText = document.getElementById('user_info_text');
        
        if (this.currentUserList && this.currentUserList.length > 0) {
            searchInput.value = this.currentUserList.join(', ');
            
            // –°–æ–∑–¥–∞–µ–º HTML —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userTags = this.currentUserList.map((user, index) => 
                `<div class="user-checkbox-item d-flex align-items-center me-2 mb-1">
                    <input type="checkbox" class="form-check-input me-1" 
                           id="user_${index}" 
                           value="${user}" 
                           data-user="${user}">
                    <label class="form-check-label user-label" for="user_${index}">
                        ${user}
                    </label>
                </div>`
            ).join('');
            
            const removeButton = this.currentUserList.length > 0 ? 
                `<button type="button" class="btn btn-sm btn-outline-danger mt-2" 
                        data-title="${title}" 
                        data-action="removeSelected" 
                        disabled>
                    üóëÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                </button>` : '';
            
            userInfoText.innerHTML = `${title}: 
                <div class="mt-1 d-flex flex-wrap">${userTags}</div>
                ${removeButton}`;
                
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è
            setTimeout(() => {
                this.updateUserSelection();
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤
                const checkboxes = document.querySelectorAll('.user-checkbox-item input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        this.updateUserSelection();
                    });
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
                const removeBtn = document.querySelector('button[data-action="removeSelected"]');
                if (removeBtn) {
                    removeBtn.addEventListener('click', () => {
                        const title = removeBtn.getAttribute('data-title');
                        this.removeSelectedUsers(title);
                    });
                }
            }, 50);
        } else {
            searchInput.value = `–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${title}"`;
            userInfoText.textContent = `${title}: –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`;
        }
    }
    
    updateUserSelection() {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —á–µ–∫–±–æ–∫—Å–æ–≤
        const checkboxes = document.querySelectorAll('.user-checkbox-item input[type="checkbox"]');
        const removeButton = document.querySelector('button[data-action="removeSelected"]');
        
        console.log('updateUserSelection called');
        console.log('Found checkboxes:', checkboxes.length);
        console.log('Found button:', removeButton);
        
        if (removeButton) {
            const hasSelected = Array.from(checkboxes).some(cb => {
                console.log('Checkbox checked:', cb.checked, cb.value);
                return cb.checked;
            });
            
            console.log('Has selected:', hasSelected);
            
            removeButton.disabled = !hasSelected;
            removeButton.textContent = hasSelected ? 'üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö' : 'üóëÔ∏è –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è –ª—É—á—à–µ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–∏
            if (hasSelected) {
                removeButton.classList.remove('btn-outline-danger');
                removeButton.classList.add('btn-danger');
            } else {
                removeButton.classList.remove('btn-danger');
                removeButton.classList.add('btn-outline-danger');
            }
        }
    }
    
    removeSelectedUsers(title) {
        const checkboxes = document.querySelectorAll('.user-checkbox-item input[type="checkbox"]:checked');
        const usersToRemove = Array.from(checkboxes).map(cb => cb.value);
        
        if (usersToRemove.length > 0 && this.currentUserList) {
            // –£–¥–∞–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Å–ø–∏—Å–∫–∞
            this.currentUserList = this.currentUserList.filter(user => !usersToRemove.includes(user));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            this.updateUserListDisplay(title);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Å –Ω–æ–≤—ã–º —Å–ø–∏—Å–∫–æ–º
            const hiddenInput = document.getElementById('selected_user_value');
            if (this.currentUserList.length > 0) {
                hiddenInput.value = `CUSTOM_LIST:${this.currentUserList.join(',')}`;
            } else {
                hiddenInput.value = '';
            }
        }
    }
    
    removeUserFromList(userToRemove, title) {
        // –û—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        if (this.currentUserList) {
            this.currentUserList = this.currentUserList.filter(user => user !== userToRemove);
            this.updateUserListDisplay(title);
            
            const hiddenInput = document.getElementById('selected_user_value');
            if (this.currentUserList.length > 0) {
                hiddenInput.value = `CUSTOM_LIST:${this.currentUserList.join(',')}`;
            } else {
                hiddenInput.value = '';
            }
        }
    }
    
    initializeDisplay() {
        const searchInput = document.getElementById('user_search_enhanced');
        if (this.selectedUser) {
            if (this.selectedUser === 'ACTIVE_USERS') {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                const activeUsers = this.users.filter(user => 
                    !user.includes('example.com') && !user.toLowerCase().includes('admin')
                );
                const activeUsersList = activeUsers.length > 0 ? activeUsers.join(', ') : '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π';
                searchInput.value = activeUsersList;
            } else if (this.selectedUser.startsWith('CUSTOM_LIST:')) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                const userList = this.selectedUser.substring(12).split(',').map(u => u.trim()).filter(u => u);
                searchInput.value = userList.join(', ');
            } else {
                searchInput.value = this.selectedUser;
            }
        }
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    new EnhancedUserSearch();
});
</script>

{% endblock %}